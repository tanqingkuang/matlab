
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>main</title><meta name="generator" content="MATLAB 9.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2023-07-20"><meta name="DC.source" content="main.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#1">I.&#28165;&#31354;&#29615;&#22659;&#21464;&#37327;</a></li><li><a href="#2">II.&#35757;&#32451;&#38598;&#21644;&#27979;&#35797;&#38598;&#30340;&#20135;&#29983;</a></li><li><a href="#5">III. &#25968;&#25454;&#24402;&#19968;&#21270;</a></li><li><a href="#6">IV. BP&#31070;&#32463;&#32593;&#32476;&#21019;&#24314;&#12289;&#35757;&#32451;&#21450;&#20223;&#30495;&#27979;&#35797;</a></li><li><a href="#12">V. &#24615;&#33021;&#35780;&#20215;</a></li><li><a href="#13">VI. &#32472;&#22270;</a></li></ul></div><h2>I.&#28165;&#31354;&#29615;&#22659;&#21464;&#37327;<a name="1"></a></h2><pre class="codeinput">clear <span class="string">all</span>
clc
</pre><h2>II.&#35757;&#32451;&#38598;&#21644;&#27979;&#35797;&#38598;&#30340;&#20135;&#29983;<a name="2"></a></h2><p>1. &#23548;&#20837;&#25968;&#25454;</p><pre class="codeinput">load <span class="string">spectra_data.mat</span>
</pre><p>2.&#38543;&#26426;&#20135;&#29983;&#35757;&#32451;&#38598;&#21644;&#27979;&#35797;&#38598;</p><pre class="codeinput">temp = randperm(size(NIR, 1));
<span class="comment">% &#35757;&#32451;&#38598; &#8212;&#8212; 80%&#20316;&#20026;&#26679;&#26412;</span>
M = size(NIR, 1) * 0.8;
P_train = NIR(temp(1:M),:)';
I_train = octane(temp(1:M),:)';
<span class="comment">% &#27979;&#35797;&#38598; &#8212;&#8212; 20%&#20316;&#20026;&#27979;&#35797;</span>
P_test = NIR(temp(M+1:end),:)';
I_test = octane(temp(M+1:end),:)';
N = size(P_test, 2);
</pre><h2>III. &#25968;&#25454;&#24402;&#19968;&#21270;<a name="5"></a></h2><pre class="codeinput">[p_train, ps_input] = mapminmax(P_train, 0, 1);
p_test = mapminmax(<span class="string">'apply'</span>, P_test, ps_input);

[t_train, ps_output] =  mapminmax(I_train, 0, 1);
</pre><h2>IV. BP&#31070;&#32463;&#32593;&#32476;&#21019;&#24314;&#12289;&#35757;&#32451;&#21450;&#20223;&#30495;&#27979;&#35797;<a name="6"></a></h2><p>1. &#21019;&#24314;&#32593;&#32476;</p><pre class="codeinput">net = newff(p_train, t_train, 9);
<span class="comment">% view(net)</span>
</pre><p>2. &#35774;&#32622;&#35757;&#32451;&#21442;&#25968;</p><pre class="codeinput">net.trainParam.epochs = 1000;
net.trainParam.goal = 1e-4;
net.trainParam.lr = 0.01;
</pre><p>3. &#35757;&#32451;&#20989;&#25968;</p><pre class="codeinput">net = train(net, p_train, t_train);
</pre><p>4. &#20223;&#30495;&#27979;&#35797;</p><pre class="codeinput">t_sim = sim(net, p_test);
</pre><p>5. &#25968;&#25454;&#21453;&#24402;&#19968;&#21270;</p><pre class="codeinput">I_sim = mapminmax(<span class="string">'reverse'</span>, t_sim, ps_output);
</pre><h2>V. &#24615;&#33021;&#35780;&#20215;<a name="12"></a></h2><pre class="codeinput">error = abs(I_sim - I_test)./I_test;
result = [I_test', I_sim', error']
</pre><pre class="codeoutput">
result =

   97.7500   97.5967    0.0016
   99.3500   98.9159    0.0044
   97.9500   97.7719    0.0018
   91.5500   91.4303    0.0013
   96.5500   96.4988    0.0005
   90.5500   90.3814    0.0019
   92.8500   92.8067    0.0005
   90.7500   90.5883    0.0018
   98.2500   98.0296    0.0022
   94.3500   94.3501    0.0000
   91.8500   91.7489    0.0011
   90.1500   89.9744    0.0019
   96.9500   96.8726    0.0008
   98.5500   98.2808    0.0027
   90.6500   90.4846    0.0018
   97.3500   97.2390    0.0011
   93.7500   93.7404    0.0001
   92.1500   92.0675    0.0009
   96.4500   96.4044    0.0005
   99.1500   98.7621    0.0039

</pre><h2>VI. &#32472;&#22270;<a name="13"></a></h2><pre class="codeinput">figure
plot(1:N, I_test, <span class="string">'b:*'</span>, 1:N, I_sim, <span class="string">'r-o'</span>)
</pre><img vspace="5" hspace="5" src="main_01.png" style="width:560px;height:420px;" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% I.清空环境变量
clear all
clc

%% II.训练集和测试集的产生
%%
% 1. 导入数据
load spectra_data.mat

%% 
% 2.随机产生训练集和测试集
temp = randperm(size(NIR, 1));
% 训练集 —— 80%作为样本
M = size(NIR, 1) * 0.8;
P_train = NIR(temp(1:M),:)';
I_train = octane(temp(1:M),:)';
% 测试集 —— 20%作为测试
P_test = NIR(temp(M+1:end),:)';
I_test = octane(temp(M+1:end),:)';
N = size(P_test, 2);

%% III. 数据归一化
[p_train, ps_input] = mapminmax(P_train, 0, 1);
p_test = mapminmax('apply', P_test, ps_input);

[t_train, ps_output] =  mapminmax(I_train, 0, 1);

%% IV. BP神经网络创建、训练及仿真测试
%%
% 1. 创建网络
net = newff(p_train, t_train, 9);
% view(net)

%% 
% 2. 设置训练参数
net.trainParam.epochs = 1000;
net.trainParam.goal = 1e-4;
net.trainParam.lr = 0.01;

%%
% 3. 训练函数
net = train(net, p_train, t_train);

%%
% 4. 仿真测试
t_sim = sim(net, p_test);

%%
% 5. 数据反归一化
I_sim = mapminmax('reverse', t_sim, ps_output);

%% V. 性能评价
error = abs(I_sim - I_test)./I_test;
result = [I_test', I_sim', error']

%% VI. 绘图
figure
plot(1:N, I_test, 'b:*', 1:N, I_sim, 'r-o')


##### SOURCE END #####
--></body></html>